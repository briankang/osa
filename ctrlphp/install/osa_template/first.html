<?php require 'header.html'?>
<?php
if(@!$_POST['submit'] && @!$_GET['licenses']){
	Header("Location:../install/index.php");
}
$OSA_PATH=trim(preg_replace("/ctrlphp.*/",' ',str_replace('\\', '/', dirname(__FILE__))));
?>
	<div id="main">
	    <div class="biaoti">
	        <p><span><img src="osa_template/img/01.gif" /></span><span class="title1">环境检查</span></p>
	        <p class="text1">环境以及文件目录权限检查</p>
	    </div>
	    <div class="clearfloat"></div>
	    <div class="check">
	        <div class="setup">
	            <ul>
	                <li class="step"><p>检查安装环境</p></li>
	                <li class="step"><p>设置运行环境</p></li>
	                <li class="selstep"><p>创建数据库</p></li>
	                <li class="overselstep"><p>完成安装</p></li>
	            </ul>
	        </div>
	        <div class="clearfloat"></div>
	        <table class="bge1">
	         	<tbody>
	            <tr class="tit">
		              <td>项目</td>
		              <td>OSA！所需环境</td>
		              <td>OSA最佳</td>
		              <td>当前服务器</td>
	            </tr>
	            <tr>  
	                 <td>操作系统</td>
	                 <td>不限制</td>
	                 <td>类Unix</td>
	                 <td><span class="check_up_img"><img src="osa_template/img/right1.gif" /></span><span class="check_up_text"><?php echo php_uname('s');?></span></td> 
                </tr>
                <tr>  
	                 <td>PHP版本</td>
	                 <td>5.2.0</td>
	                 <td>5.2.0</td>
	                 <td><span class="check_up_img"><img src="osa_template/img/<?php echo $php_version; ?>.gif" /></span><span class="check_up_text"><?php echo phpversion();?></span></td> 
                </tr>
                <tr>  
	                 <td>pdo_mysql</td>
	                 <td>支持</td>
	                 <td>支持</td>
	                 <td><span class="check_up_img"><img src="osa_template/img/<?php echo $php_pdo_mysql; ?>.gif" /></span><span class="check_up_text"><?php if($php_pdo_mysql==1){ echo "支持";}else{ echo "<font color='red'>不支持</font>";} ?></span></td> 
                </tr>
                <tr>  
	                 <td>mbstring</td>
	                 <td>支持</td>
	                 <td>支持</td>
	                 <td><span class="check_up_img"><img src="osa_template/img/<?php echo $php_mbstring; ?>.gif" /></span><span class="check_up_text"><?php if($php_mbstring==1){ echo "支持";}else{ echo "<font color='red'>不支持</font>";} ?></span></span></td> 
                </tr>
                <tr>  
	                 <td>json</td>
	                 <td>支持</td>
	                 <td>支持</td>
	                 <td><span class="check_up_img"><img src="osa_template/img/<?php echo $php_json; ?>.gif" /></span><span class="check_up_text"><?php if($php_json==1){ echo "支持";}else{ echo "<font color='red'>不支持</font>";} ?></span></td> 
                </tr>
                <tr>  
	                 <td>curl</td>
	                 <td>支持</td>
	                 <td>支持</td>
	                 <td><span class="check_up_img"><img src="osa_template/img/<?php echo $php_curl; ?>.gif" /></span><span class="check_up_text"><?php if($php_curl==1){ echo "支持";}else{ echo "<font color='red'>不支持</font>";} ?></span></td> 
                </tr>
                <tr>  
	                 <td>磁盘空间</td>
	                 <td>20M</td>
	                 <td>不限制</td>
	                 <td><span class="check_up_img"><img src="osa_template/img/<?php echo $osa_disk_check; ?>.gif" /></span><span class="check_up_text"><?php printf("%s MB",round((disk_free_space($_SERVER['DOCUMENT_ROOT']) / 1048576), 0)); ?></span></td> 
                </tr>
                <tr>  
	                 <td>python相关</td>
	                 <td colspan="2">请手动运行:<a title='<?php echo $OSA_PATH."ctrlphp/install/auto_prepare.sh";?>'>install/auto_prepare.sh</a></td>
	                 <td><span class="check_up_img"><img src="osa_template/img/<?php echo $check_python; ?>.gif" /></span><span class="check_up_text"><?php if($check_python==1){ echo "已运行";}else{ echo "<font color='red'>未运行</font>";} ?></span></td> 
                </tr>
	            </tbody>
	     </table>
	     <table class="bge1">
			<tbody>
                     <tr class="tit">
                       <td>文件目录</td>
                       <td>所需状态</td>
                       <td>当前状态</td>
                     </tr>
                     <tr>  
                       <td class="dress" title="<?php echo $OSA_PATH.'ctrlphp/';?>">/osa/ctrlphp/</td>
                       <td><img src="osa_template/img/right2.gif" />可写</td>
                       <td><span class="check_up_img"><img src="osa_template/img/<?php echo $ctrlphp_dir; ?>.gif" /></span><span class="check_up_text"><?php if($ctrlphp_dir==1){ echo "可写";}else{ echo "<font color='red'>不可写</font>";} ?></span></td>
                     </tr>
                     <tr>  
                       <td class="dress" title="<?php echo $OSA_PATH.'ctrlphp/etc/';?>">/osa/ctrlphp/etc/</td>
                       <td><img src="osa_template/img/right2.gif" />可写</td>
                       <td><span class="check_up_img"><img src="osa_template/img/<?php echo $ctrlphp_etc; ?>.gif" /></span><span class="check_up_text"><?php if($ctrlphp_etc==1){ echo "可写";}else{ echo "<font color='red'>不可写</font>";} ?></td>
                     </tr>
                     <tr>  
                       <td class="dress" title="<?php echo $OSA_PATH.'ctrlpy/etc/config.py';?>">/osa/ctrlpy/etc/config.py</td>
                       <td><img src="osa_template/img/right2.gif" />可写</td>
                       <td><span class="check_up_img"><img src="osa_template/img/<?php echo $ctrlpy_config; ?>.gif" /></span><span class="check_up_text"><?php if($ctrlpy_config==1){ echo "可写";}else{ echo "<font color='red'>不可写</font>";} ?></span></td>
                     </tr>
                     <tr>  
                       <td class="dress" title="<?php echo $OSA_PATH.'unctrlpy/etc/config.py';?>">/osa/unctrlpy/etc/config.py</td>
                       <td><img src="osa_template/img/right2.gif" />可写</td>
                       <td><span class="check_up_img"><img src="osa_template/img/<?php echo $unctrlpy_config; ?>.gif" /></span><span class="check_up_text"><?php if($unctrlpy_config==1){ echo "可写";}else{ echo "<font color='red'>不可写</font>";} ?></span></td>
                     </tr>
                     <tr>  
                       <td class="dress" title="<?php echo $OSA_PATH.'ctrlphp/session/';?>">/osa/ctrlphp/session/</td>
                       <td><img src="osa_template/img/right2.gif" />可写</td>
                       <td><span class="check_up_img"><img src="osa_template/img/<?php echo $phpsession_path; ?>.gif" /></span><span class="check_up_text"><?php if($phpsession_path==1){ echo "可写";}else{ echo "<font color='red'>不可写</font>";} ?></span></td>
                     </tr>
                </tbody>
		 </table>        	  
		</div>
	</div>
	<div class="clearfloat"></div>

	  <!--内容结束-->
	  <div class="button">
		  <span><input type="button" value="上一步"  class="btnbox" onclick="window.location.href='index.php'" /></span>
		  <?php if($check_sucess==1) {?>
		   <span><input type="button" value="下一步" class="btnbox"  onclick="window.location.href='index.php?step=2'"/></span>
		   <?php }else{ ?> 
		   <span><input type="button" value="重新检测" class="btnbox" onclick="window.location.href='index.php?step=1&licenses=1'"/></span>
		   <?php } ?>
	  </div>  
        <div class="clearfloat"></div>
        
        <div id="footer">
        	<p>©2011 - 2015 OSA开源团队.</p>
        </div>
    </div>
</body>
</html>
